# Use the official TensorFlow GPU image as a base image
FROM tensorflow/tensorflow:latest-gpu

# Set environment variables to match the host user and UID
ARG USER_NAME
ARG USER_UID
ENV USER_NAME=$USER_NAME
ENV USER_UID=$USER_UID

# Install system dependencies for OpenCV and other packages
RUN apt-get update && apt-get install -y \
    libgl1-mesa-glx wget \
 && rm -rf /var/lib/apt/lists/*

# Create a new user in the container with the same UID as the host user
RUN useradd -m -u $USER_UID $USER_NAME

# Set the user as the default user for the container
USER $USER_NAME

# Create a working directory (you can change this to match your needs)
WORKDIR /home/$USER_NAME

# Add local bin to PATH
ENV PATH="/home/${USERNAME}/.local/bin:${PATH}"

# Install Python packages using pip
RUN pip install --upgrade pip && \
    pip install poetry==1.7.0  --no-cache-directory

RUN poetry install --no-interaction --no-ansi
